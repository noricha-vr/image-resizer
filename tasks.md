# Image Resizer 実装タスク一覧

## 概要
画像リサイズサービスの実装を段階的に進めるためのタスク分解。
JPEG/PNG/AVIF形式への変換に対応し、各フェーズごとに動作確認可能な単位で実装を進める。

## フェーズ1: 基盤構築 (優先度: 高)

### 1.1 開発環境セットアップ
- [ ] TailwindCSSの導入と設定
  - [ ] `bun install -D tailwindcss postcss autoprefixer`
  - [ ] `bunx tailwindcss init -p`
  - [ ] tailwind.config.jsの設定
  - [ ] src/index.cssにTailwindディレクティブ追加
- [ ] react-dropzoneのインストール
  - [ ] `bun install react-dropzone`
  - [ ] `bun install -D @types/react-dropzone`
- [ ] テスト環境の構築
  - [ ] `bun install -D vitest @testing-library/react @testing-library/jest-dom`
  - [ ] vitest.config.tsの作成
- [ ] ディレクトリ構造の作成
  - [ ] src/components/
  - [ ] src/hooks/
  - [ ] src/utils/
  - [ ] src/types/
  - [ ] tests/unit/
  - [ ] tests/e2e/

### 1.2 型定義
- [ ] src/types/index.tsの作成
  - [ ] ImageFileインターフェース定義
  - [ ] ProcessedImageインターフェース定義
  - [ ] ResizeSettingsインターフェース定義（outputFormat追加）
  - [ ] OutputFormat列挙型定義（JPEG/PNG/AVIF）
  - [ ] ProcessingStatus列挙型定義
  - [ ] ValidationResult型定義

## フェーズ2: コア機能実装 (優先度: 高)

### 2.1 画像処理ユーティリティ
- [ ] src/utils/imageResizer.ts
  - [ ] アスペクト比を維持したサイズ計算ロジック
  - [ ] Canvas APIによるリサイズ処理
  - [ ] 形式別変換処理
    - [ ] JPEG変換（toBlob('image/jpeg', quality)）
    - [ ] PNG変換（toBlob('image/png')）
    - [ ] AVIF変換（toBlob('image/avif', quality)）
  - [ ] サムネイル生成処理（150px固定、元形式維持）
  - [ ] 形式別の品質設定処理
  - [ ] エラーハンドリング
  - [ ] 単体テスト作成

### 2.2 ファイル検証ユーティリティ
- [ ] src/utils/fileValidator.ts
  - [ ] 画像ファイル形式の検証（JPEG、PNG、WebP、GIF対応）
  - [ ] ファイルサイズ制限チェック（最大10MB）
  - [ ] MIMEタイプ検証
  - [ ] 拡張子チェック
  - [ ] エラーメッセージ生成
  - [ ] 単体テスト作成

### 2.3 ダウンロードヘルパー
- [ ] src/utils/downloadHelper.ts
  - [ ] BlobからダウンロードURLの生成
  - [ ] ファイル名生成（filename_[maxsize]px.[ext]形式）
    - [ ] JPEG: .jpg拡張子
    - [ ] PNG: .png拡張子
    - [ ] AVIF: .avif拡張子
  - [ ] 個別ダウンロード機能
  - [ ] 一括ダウンロード（ZIP化検討）
  - [ ] URLオブジェクトの適切なrevoke
  - [ ] 単体テスト作成

### 2.4 ストレージ管理
- [ ] src/utils/storageHelper.ts
  - [ ] localStorageへの設定保存（キー: imageResizerSettings）
    - [ ] maxSize
    - [ ] quality
    - [ ] outputFormat（JPEG/PNG/AVIF）
  - [ ] 設定の読み込みとデフォルト値へのフォールバック
  - [ ] 設定のバリデーション
  - [ ] 単体テスト作成

## フェーズ3: カスタムフック実装 (優先度: 高)

### 3.1 画像処理フック
- [ ] src/hooks/useImageProcessor.ts
  - [ ] 処理キューの管理
  - [ ] 順次処理の実装
  - [ ] 進捗状態の管理
  - [ ] エラーハンドリング
  - [ ] キャンセル機能
  - [ ] 統合テスト作成

### 3.2 ドロップゾーンフック
- [ ] src/hooks/useDropzone.ts
  - [ ] react-dropzoneのラッパー
  - [ ] ファイル検証の統合
  - [ ] ドラッグ状態の管理
  - [ ] エラー状態の管理
  - [ ] 統合テスト作成

### 3.3 localStorage管理フック
- [ ] src/hooks/useLocalStorage.ts
  - [ ] 汎用的なlocalStorageフック
  - [ ] 設定の永続化
  - [ ] 自動同期機能
  - [ ] 単体テスト作成

## フェーズ4: UIコンポーネント実装 (優先度: 中)

### 4.1 ドロップゾーンコンポーネント
- [ ] src/components/DropZone.tsx
  - [ ] ドラッグ&ドロップエリアのUI
  - [ ] ファイル選択ボタン
  - [ ] ドラッグオーバー時のビジュアルフィードバック
  - [ ] エラー表示
  - [ ] 使用方法の説明テキスト
  - [ ] コンポーネントテスト作成

### 4.2 設定パネル
- [ ] src/components/SettingsPanel.tsx
  - [ ] 最大サイズ入力フィールド（デフォルト720px）
  - [ ] 品質スライダー（50-100%、デフォルト80%）
  - [ ] 出力形式選択ボタン/セレクト
    - [ ] JPEG選択
    - [ ] PNG選択（品質設定無効化）
    - [ ] AVIF選択
  - [ ] 設定の保存・読み込み
  - [ ] バリデーション表示
  - [ ] リセット機能
  - [ ] コンポーネントテスト作成

### 4.3 処理キュー表示
- [ ] src/components/ProcessingQueue.tsx
  - [ ] 待機中ファイルのリスト表示
  - [ ] 処理中ファイルのプログレスバー
  - [ ] エラー状態の表示
  - [ ] キャンセルボタン
  - [ ] 完了状態の表示
  - [ ] コンポーネントテスト作成

### 4.4 結果ギャラリー
- [ ] src/components/ResultGallery.tsx
  - [ ] サムネイルグリッド表示
  - [ ] レスポンシブレイアウト
  - [ ] 個別ダウンロードボタン
  - [ ] 一括ダウンロードボタン
  - [ ] ファイル情報表示（サイズ、形式）
  - [ ] 形式別アイコン/バッジ表示
  - [ ] コンポーネントテスト作成

### 4.5 サムネイルカード
- [ ] src/components/ThumbnailCard.tsx
  - [ ] 150pxサムネイル表示
  - [ ] ファイル名表示（形式に応じた拡張子）
  - [ ] 形式インジケーター（JPEG/PNG/AVIF）
  - [ ] ダウンロードボタン
  - [ ] 削除ボタン
  - [ ] ローディング状態
  - [ ] コンポーネントテスト作成

### 4.6 画像処理コンポーネント
- [ ] src/components/ImageProcessor.tsx
  - [ ] 処理ロジックの統合
  - [ ] 状態管理
  - [ ] エラーハンドリング
  - [ ] 子コンポーネントの連携
  - [ ] 統合テスト作成

## フェーズ5: アプリケーション統合 (優先度: 中)

### 5.1 メインアプリケーション
- [ ] src/App.tsxの実装
  - [ ] レイアウト構築
  - [ ] コンポーネントの配置
  - [ ] 状態管理の統合
  - [ ] エラーバウンダリ
  - [ ] ローディング状態

### 5.2 スタイリング
- [ ] グローバルスタイルの設定
- [ ] ダークモード対応（オプション）
- [ ] アニメーション追加
- [ ] レスポンシブデザイン調整
- [ ] アクセシビリティ改善

## フェーズ6: パフォーマンス最適化 (優先度: 低)

### 6.1 処理最適化
- [ ] Web Workerの導入（大量ファイル処理用）
- [ ] OffscreenCanvasの活用
- [ ] メモリ管理の最適化
- [ ] 段階的な品質調整

### 6.2 UI最適化
- [ ] 仮想スクロールの実装（大量サムネイル用）
- [ ] 遅延ローディング
- [ ] デバウンス・スロットル処理
- [ ] コード分割

## フェーズ7: テスト・品質保証 (優先度: 中)

### 7.1 単体テスト
- [ ] すべてのユーティリティ関数のテスト
- [ ] カスタムフックのテスト
- [ ] カバレッジ80%達成

### 7.2 統合テスト
- [ ] ファイル処理フローのテスト
- [ ] UI操作のテスト
- [ ] エラーケースのテスト

### 7.3 E2Eテスト
- [ ] 主要な使用シナリオのテスト
- [ ] Chrome最新版での動作確認
- [ ] パフォーマンステスト

## フェーズ8: デプロイメント準備 (優先度: 低)

### 8.1 ビルド設定
- [ ] Viteビルド設定の最適化
- [ ] 環境変数の設定
- [ ] ビルドサイズの最適化

### 8.2 CI/CD設定
- [ ] GitHub Actionsワークフロー作成
- [ ] 自動テスト実行
- [ ] 自動デプロイ設定

### 8.3 Cloudflare Pages設定
- [ ] プロジェクト接続
- [ ] ビルド設定
- [ ] カスタムドメイン設定（必要な場合）
- [ ] セキュリティヘッダー設定

## フェーズ9: ドキュメント作成 (優先度: 低)

### 9.1 ユーザー向けドキュメント
- [ ] README.mdの更新
- [ ] 使用方法ガイド
- [ ] FAQ作成

### 9.2 開発者向けドキュメント
- [ ] コンポーネントドキュメント
- [ ] APIドキュメント
- [ ] コントリビューションガイド

## 実装順序の推奨

1. **第1週**: フェーズ1（基盤構築）+ フェーズ2の一部（コアユーティリティ）
2. **第2週**: フェーズ2完了 + フェーズ3（カスタムフック）
3. **第3週**: フェーズ4（UIコンポーネント）+ フェーズ5（統合）
4. **第4週**: フェーズ7（テスト）+ フェーズ6（最適化）
5. **第5週**: フェーズ8（デプロイ）+ フェーズ9（ドキュメント）

## 完了条件

- [ ] JPEG/PNG/AVIF形式への変換が選択可能
- [ ] アスペクト比を維持したリサイズが動作する
- [ ] localStorageに設定が保存される（形式設定含む）
- [ ] ドラッグ&ドロップが正常に動作する
- [ ] Chrome最新版で全機能が動作する
- [ ] 形式によって適切な品質設定が適用される
- [ ] テストカバレッジ80%以上
- [ ] Cloudflare Pagesにデプロイ完了
- [ ] ドキュメント作成完了

## 注意事項

- **形式選択**: JPEG/PNG/AVIFから選択可能（デフォルトJPEG）
- **Chrome専用**: 他ブラウザ対応は不要（AVIF対応のため）
- **クライアント完結**: サーバーへの画像送信なし
- **品質設定**:
  - JPEG: 50-100%（デフォルト80%）
  - PNG: 可逆圧縮のため品質設定なし
  - AVIF: 50-100%（デフォルト80%）
- **最大サイズ**: デフォルト720px（変更可能）
- **サムネイル**: 150px固定サイズ（選択形式と同じ）
- **ファイル名**: `filename_[maxsize]px.[ext]` 形式
- **localStorage**: 形式設定も保存される